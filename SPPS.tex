\documentclass[a4paper,twoside,11pt]{article}
\usepackage[cp1251]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{fancyhdr}
\usepackage{newprog1e}
\usepackage{amsfonts,amsmath,amssymb,amsthm}
\usepackage{graphicx}
\graphicspath{{./images_rus/}}
\usepackage{subcaption}

\usepackage{blindtext}
\usepackage{color,soul}

\tolerance=1000

\newcommand{\defi}{\stackrel{\mathrm{def}}{=}}

\numberwithin{equation}{section}
\newtheorem{theorem}{Теорема}

\newtheorem{definition}{Definition}
\newtheorem{theorem_ru}{Теорема}


\journalnumber{3}
\curyear{2020}
\authorlist{ДАНИЛОВ И ДР.}
\titlehead{\uppercase{Сегментация динамически изменяемыми суперпикселями}}
\headerdef

\udk{004.932}
\rubrika{АНАЛИЗ ДАННЫХ}
\dateinput{19.12.2019}

\rusabstr{Представленная работа посвящена новому методу сегментации медицинских данных на основе распространения суперпикселей. Предлагаемый метод является модификацией классического алгоритма сегментации на основе выращивания регионов и отчасти наследует концепцию октодеревьев. Основным отличием данного подхода является переход в домен суперпикселей, а также более гибкие условия объединения суперпикселей в регион. В ходе выполнения алгоритма для объединения суперпикселей выполняются проверки на соответствие критериям однородности. Во-первых, средняя интенсивность суперпикселя сравнивается с интенсивностью полученного региона. Во-вторых, каждый пиксель, лежащий на рёбрах и диагоналях суперпикселя сравнивается с пороговым значением. Важной особенностью предлагаемого метода является динамически изменяемый (плавающий) размер суперпикселей. Формирование итогового региона осуществляется посредством построения сплайна по точкам пересечения внешних, по отношению к региону, суперпикселей. В качестве данных для оценки точности метода использовались МРТ изображения левого желудочка сердца, полученные в Университете Йорка, и опухоли головного мозга, полученные в Южном Медицинском Университетом. С целью демонстрации быстродействия метода дополнительно создан набор синтетических изображений высокого разрешения. В качестве метрики оценки точности использован коэффициент подобия Дайса. Его значения для предлагаемого метода соответствуют 0.93$\pm$0.03 и 0.89$\pm$0.07 при сегментации левого желудочка и опухоли соответственно. На основе приведённого в статье примера показано, что поэтапное уменьшение размера суперпикселя позволяет значительно увеличить скорость работы метода без потери точности.}

\author{
{\bfseries В.В.~Данилов$^{1}$, О.М.~Гергет$^{1,2}$, И.П.~Скирневский$^{1}$, Р.А.~Манаков$^{1}$, Д.Ю.~Колпащиков$^{1}$} \\ {\itshape $^{1}$Лаборатория дизайна медицинских изделий, Томский политехнический университет} \\ 
{\slshape 634050} {\itshape Томск, проспект Ленина, д. 2, стр. 33} \\ 
{\itshape E-mail:  } \\
{\itshape $^{2}$Сибирский государственный медицинский университет} \\ 
{\slshape 634050} {\itshape Томск, Московский тракт, д. 2} \\ 
{\itshape E-mail: }}

\title{\uppercase{Сегментация на основе распространения динамически изменяемых суперпикселей}
\thanks{Данная работа выполнена в рамках государственного задания «Наука» \textnumero     17.8205.2017/БЧ «Моделирование и алгоритмизация процессов обработки, анализа и репрезентации графических данных в режиме реального времени для проведения эндоваскулярных операций на сердце» (дополнительный номер: 4.1769.ГЗБ.2017).}}

\begin{document}

\maketitle
\setcounter{page}{1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\He{\uppercase{Введение}}
\label{introduction}

Одной из основных задач при работе с медицинскими изображениями является точное выделение области интереса. Данная задача может быть решена методами сегментации \cite{Huang2013}--\cite{Pham2000}. Однако, для получения результатов, удовлетворяющих заданной точности, требуется проведение предобработки исходных данных. Следует отметить, что полуавтоматические методы сегментации все еще остаются популярными, поскольку не предъявляют высоких требований к вычислительным ресурсам и являются относительно простыми в реализации. В настоящее время хорошо зарекомендовали себя в области обработки медицинских данных методы машинного обучения, так как позволяют получить высокую точность распознавания образов и устойчивость к различного рода шумам и артефактам \cite{Kang2016}--\cite{Oktay2018}. Машинное обучение активно применяется для решения задач выделения новообразований, в частности, с целью сегментации опухолей головного мозга \cite{Pereira2016}. Активное внедрение нейронных сетей наблюдается не только для сегментации изображений. Спектр применения методов этого класса достаточно широк: классификации, кластеризация, поиск объектов, шумоподавление и другое \cite{Kamnitsas2016, Litjens2017}. 

Несмотря на то, что методы на основе нейронных сетей позволяют выполнять сегментацию трёхмерных объектов, популярными остаются подходы, при которых трехмерные данные раскладываются на массивы двумерных проекций так называемых слайсов. Каждый слайс обрабатывается отдельно, а затем происходит процесс восстановления 3D объекта \cite{Danilov2018, Danilov2019}. Разложение трёхмерных данных на двумерные составляющие является эффективным инструментом и активно используется в медицине, поскольку в большинстве случаев не требуется проведения анализа всего анатомического объекта. Подобные упрощения играют важную роль в развитии классических методов сегментации, к числу которых относятся методы активных контуров (AC, сокр. от Active Contours), методы выращивания регионов (RG, сокр. от Region Growing), водоразделов (от англ. Watershed). Следует также отметить, что во многих программных продуктах, используемых для разметки и подготовки данных, применяются встроенные полуавтоматические методы сегментации, которые позволяют оператору значительно упростить процесс разметки.

В данной работе продемонстрирован метод двухмерной сегментации медицинских данных на основе распространения суперпикселей с динамически изменяющимся размером. Концепция данного метода базируется на работах Dana Ballard и Richard Adams \cite{Ballard1982, Adams1994}. Ключевая особенность метода при делении суперпикселей была унаследовала от октодеревьев.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\He{\uppercase{Связанные исследования}}
\label{related_works}

Метод сегментации на основе выращивания регионов был впервые представлен более десяти лет назад и постоянно ведутся исследования с целью его улучшения. В работе \cite{Tang2010} Jun Tang предлагает выполнять сегментацию цветных изображений на основе комбинации методов выращивания регионов и водоразделов. Несмотря на то, что совместная реализацию двух методов дала прирост в точности распознавания, сами методы по-прежнему оставались трудоёмкими.

Одна из известных модификаций метода выращивания регионов представлена в работе Joung Park и Chulhee Lee \cite{Park2009}. В данной работе применение морфологических алгоритмов позволило избежать ручной установки начальной точки, которая является обязательным шагом в классическом варианте метода. На основе морфологической маски автоматически осуществлялся поиск начальной точки области интереса и заднего фона. Подобные улучшения применялись и другими авторами, позволяя перейти из домена полуавтоматической сегментации к автоматическим методам. Однако такие известные проблемы этих методов как пересегментация и чувствительность к шуму не были устранены до сих пор \cite{Chiverton2007, Roy2015}.

С целью автоматического вычисления начальной точки для метода выращивания регионов были предложены различные подходы, которые позволяли с разной точностью определить пиксели, связанные с областью интереса без участия оператора. В работе \cite{Isa2005} Nor Isa предлагает целую серию изменений метода RG, связанных с определением порогового значения, процесса присоединения пикселей к региону интереса и инициализации алгоритма. В частности, в статье описывается использование метода кластеризации k-средних для определения области интереса и заднего фона.  Все описанные улучшения значительно увеличивают точность метода, однако обладают высокой вычислительной сложностью, что сильно сказывается на времени сегментации.

В процессе исследований также были предприняты попытки комбинирования метода RG и нечёткой логики. В работе \cite{Dehmeshki2008} авторы применяют так называемый нечётко связанный метод выращивания регионов (Fuzzy Connectivity Region Growing) совместно с классическим методом выращивания регионов.

Другим направлением в исследованиях по сегментации изображений является переход в так называемый домен суперпикселей \cite{Crommelinck2017}--\cite{Saxen2014}. Одно из самых ранних упоминаний понятия суперпикселя с подробным описанием сути метода встречается в работе Xiaofeng Ren и Jitendra Malik \cite{Ren2003}. Под суперпикселем понимается группа пикселей, объеденных по общему признаку или группе признаков. Основным преимуществом суперпикселей является переход от элементарных составляющих изображений к группам пикселей с дальнейшим рассмотрением группы, как целого объекта. При этом ключевым недостатком большинства методов, основанных на суперпикселях, является обработка каждого пикселя в рамках группы при формировании суперпикселя. Такое ограничение не позволяет получить значительных улучшений в производительности и точности метода. Самым распространенным методом группировки пикселей является линейная кластеризация (Simple Linear Iterative Clustering) \cite{Pereira2016, Crommelinck2017, Duong2018}. Детальное описание перехода в домен суперпикселей представлено в работе Radhakrishna Achanta \cite{Achanta2012}. Автор представляет сегментацию на основе суперпикселей с использованием метода k-средних и пятимерного пространства признаков. Подход на основе суперпикселей нашёл своё применение и в сегментации изображений с высоким разрешением. В работе \cite{Csillik2017} Ovidiu Csillik демонстрирует метод сегментации изображений с высоким разрешением на основании суперпикселей, полученных линейной кластеризацией. Время, затраченное на сегментацию изображений разрешением 1347$\times$1042 и 3701$\times$3301 пикселей, составило соответственно 2 и 26 секунд. 

Несмотря на то, что двухмерная сегментация на основании суперпикселей достаточно широко распространена в литературе, в большинстве статей авторы не решают проблем, связанных с высокой сложностью алгоритмов, и, как следствие, длительного времени выполнения сегментации. В данной работе представлен метод, который при сохранении точности позволяет значительно снизить скорость обработки изображений за счёт использования суперпикселей с динамически изменяемым размером. При этом формирование суперпикселей происходит без прохода по каждому пикселю изображения.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\He{\uppercase{Данные и методы}}
\he{Исходные данные}

Для исследования и оценки точности алгоритмов были использованы данные, полученные в Университете Йорка (Йорк, Великобритания) \cite{Andreopoulos2008} и Южном Медицинском Университете (Гуанчжоу, Китай) \cite{Cheng2015, Cheng2016}. Эти данные находятся в открытом доступе и могут использоваться для проведения исследований при указании ссылки на источник.

\begin{figure}[!ht]
	\centering
    \begin{subfigure}[t]{0.49\linewidth}
		\includegraphics[width=\linewidth]{fig_1a} 
    	\caption{МРТ сердца (набор данных Университета Йорка)}
    \end{subfigure}\hfill
    \begin{subfigure}[t]{0.49\linewidth}
		\includegraphics[width=\linewidth]{fig_1b}
    	\caption{МРТ головного мозга (набор данных Южного Медицинского Университета}
    \end{subfigure}
	\caption{Примеры входных данных для оценки предлагаемого метода сегментации.}
    \label{fig:1}
\end{figure}

Первый набор данных содержит данные МРТ сердца для 33 пациентов. Данные на одного пациента представляют собой 20 фреймов, каждый из которых состоит из 8-15 слайсов. Общее количество данных составляет 7980 двухмерных изображений с разрешением 256$\times$256 пикселей. Второй набор данных содержит трёхмерные данные МРТ головного мозга 233 пациентов (в том числе с диагностируемыми менингиомой, глиомой и опухолью гипофиза) и состоит из 3064 изображений с разрешением 512$\times$512 пикселей. Разметка данных проводилась вручную и была продублирована двумя квалифицированными врачами. На изображениях сердца были получены контуры эпикарда и эндокарда левого желудочка. На данных головного мозга была выполнена ручная сегментация новообразований. Примеры изображений приведены на рисунке \ref{fig:1}. Все изображения обрабатывались на компьютере, оснащённым Intel Core i7-4820K 3.7GHz CPU и NVIDIA GeForce GTХ 960 с использованием MATLAB (MathWorks, Natick MA). 

\he{Сегментация на основе выращивания регионов}

Метод выращивания регионов построен по принципу присоединения соседних пикселей к начальной точке области интереса. Присоединение происходит исходя из условия однородности. В классической реализации алгоритма условием однородности является отклонение по яркости между соседними пикселями.  При этом связанными считаются пиксели, которые удовлетворяют критериям $4-$связности или $8-$связности.

В классической версии алгоритма существует две реализации: с начальной точкой, которая устанавливается вручную внутри области интереса; без начальной точки, в которой установка первого пикселя происходит случайным образом. Упрощенно работу алгоритма сегментации выращиванием регионов можно разделить на следующие шаги:

\begin{enumerate}
  \item Выбор начальной точки;
  \item Сравнение начальной точки с соседними пикселями по условию однородности
  \item Остановка алгоритма если все пиксели пройдены
\end{enumerate}

Функция однородности соседних пикселей описана в работе \cite{Adams1994} и представлена ниже:

\begin{equation}
	\label{eqn:1}
	P\left(x,r\right)=\left|{f\left(x\right)-\ \mu}_r\right|<T
\end{equation}
где $f(x)$ - яркость текущего пикселя, $\mu_r$ - средняя яркость региона, $T$ – пороговое значение.

\newpage
\he{Распространение суперпикселей}

Как было отмечено ранее, представленный в статье метод сегментации на основании распространения суперпикселей (SPPS, сокр. от SuperPixel Propagation Segmentation) имеет схожий с методом RG принцип работы. Однако, все вычисления переводятся в домен суперпикселей, что позволяет значительно снизить сложность алгоритма и сократить время работы. В статье используется стандартное определение суперпикселя. Для двухмерного случая суперпикселем считается группа связанных пикселей квадратной формы, объединённых некоторым условием однородности. Пиксели считаются связанными, если удовлетворяют критериям $4-$связности. Соединение соседних суперпикселей в общий регион происходит на основании нескольких критериев, описанных в главе \ref{border_detection}. Итоговый контур формируется посредством сплайна Эрмита. Предложенный алгоритм сегментации SPPS приведён на рисунке \ref{fig:2}.

\begin{figure}[ht]
	\centering
	\includegraphics[width=1\linewidth]{fig_2} 
	\caption{Алгоритм сегментации на основании распространения суперпикселей.}
    \label{fig:2}
\end{figure}

В отличии от подходов, описанных в работах \cite{Duong2018, Wang2015}, алгоритм SPPS не анализирует каждый пиксель в составе суперпикселя. Так, при переходе в домен суперпикселей размерностью 10$\times$10 пикселей, в стандартных реализациях будут обработаны все 100 пикселей, входящих в состав суперпикселя, что соответствует вычислительной сложности равной $O(n^2)$. При размере суперпикселя 10$\times$10 пикселей для каждого суперпикселя будет обработано от 30 до 60 пикселей без потери точности сегментации (количество может меняться в зависимости от расположения суперпикселя). Формирование и анализ суперпикселей детально описано в разделе \ref{border_detection}. Концепция распространения суперпикселей с изменяемым размером представлена на рисунке \ref{fig:4}.

\begin{figure}[!ht]
	\centering
    \begin{subfigure}[t]{0.49\linewidth}
		\includegraphics[width=\linewidth]{fig_4a} 
    	\caption{Исходное изображение}
    \end{subfigure}\hfill
    \begin{subfigure}[t]{0.49\linewidth}
		\includegraphics[width=\linewidth]{fig_4b}
    	\caption{Выбор начальной точки}
    \end{subfigure}
	
    \begin{subfigure}[t]{0.49\linewidth}
		\includegraphics[width=\linewidth]{fig_4c} 
    	\caption{Распространение суперпикселей начального размера (голубые блоки)}
    \end{subfigure}\hfill
    \begin{subfigure}[t]{0.49\linewidth}
		\includegraphics[width=\linewidth]{fig_4d}
    	\caption{Уменьшение размера и повторное распространение суперпикселей (фиолетовые блоки)}
    \end{subfigure}
	\caption{Концепция распространения суперпикселей внутри области интереса с последующим изменением их размера.}
    \label{fig:4}
\end{figure}

Аналогично методу выращивания регионов, процесс объединения происходит до тех пор, пока есть хотя бы одна группа пикселей (суперпиксель), которые могут быть включены в итоговый регион. Включение суперпикселя происходит только в том случае, если его стороны не пересекают границу области интереса (см. раздел \ref{border_detection}). Если на рёбрах или диагоналях суперпикселя имеется хотя бы одно пересечение с границей, суперпиксель не включается в регион, и алгоритм переходит к следующему суперпикселю.

Первый шаг алгоритма заключается в определении центральной точки начального суперпикселя. Выбор точки происходит вручную, таким образом, метод SPPS относится к классу полуавтоматических. После того как выбрана точка, вокруг неё формируется суперпиксель заданного размера. Затем диагонали и рёбра суперпикселя проверяются на предмет пересечения с границей области интереса. Если суперпиксель не пересекает границу области интереса, шаг алгоритма считается успешно завершенным. В противном случае алгоритм может продолжить работу только в том случае, если размер исходного суперпикселя будет уменьшен без изменения позиции центральной точки.

\he{Поиск граничных суперпикселей}
\label{border_detection}

В предложенном алгоритме для определения границы области интереса осуществляется обязательная проверка двух условий. Для первого условия, представленного ниже, яркость пикселей, лежащих на рёбрах и диагоналях суперпикселя, сравнивается со средней яркостью центральных пикселей уже объединенных суперпикселей. Пороговый параметр является настраиваемым параметром метода.

\begin{equation}
	\label{eqn:2}
	\Delta I=\Bigg|p_i - \frac{\sum_{j=1}^{k} p_{c_j}}{k}\Bigg|\geq T
\end{equation}
где $p_i$ - яркость текущего пикселя, $p_{c_j}$ -  интенсивность центрального пикселя, присоединённого  суперпикселя, $k$ - число присоединённых суперпикселей, $T$ – пороговое значение яркости.

Следующее условие, проверяемое параллельно, является аппроксимацией яркостей прямой. Аппроксимация производится методом наименьших квадратов по 5 точкам. Коэффициент, являющийся тангенсом угла наклона прямой, вычисляется согласно следующей формуле:

\begin{equation}
	\label{eqn:3}
	tan\ \left(\varphi\right)=\left|\frac{n\sum_{i=1}^{n}{x_iy_i}-\sum_{i=1}^{n}x_i\sum_{i=1}^{n}y_i}{n\sum_{i=1}^{n}{x_i^2-}\left(\sum_{i=1}^{n}x_i\right)^2}\right|\geq\ Slope
\end{equation}
где $x$ - точки, расположенные на ребрах и диагоналях суперпикселя (в данном случае от 1 до 5), $y$ – значение яркости, $n$ -  позиция точки на ребре. При построении вектора $x$ следует учитывать, что расстояние между пикселями является Евклидовым.

Для текущего пикселя аппроксимация производится с использованием двух пикселей слева и двух справа. Если пиксели являются граничными для данного суперпикселя, то используются дополнительные пиксели, близлежащие к границе суперпикселя. Проверка модуля тангенса угла наклона на превышение некоторого порогового значения позволяет точно детектировать границы и быть устойчивым к шумам. 
 
Проверка на наличие границы производится на рёбрах и диагоналях квадрата. Если граница обнаружена на основании выполнения хотя бы одного из условий, то решение о принадлежности суперпикселя к региону отклоняется. Таким образом достигается повышение надёжности метода.

Как показано на рисунке \ref{fig:5}, каждый суперпиксель имеет шесть сегментов (\textit{AB}, \textit{BC}, \textit{CD}, \textit{AD}, \textit{AC} и \textit{BD}). Каждый отрезок формируется массивом пикселей. Таким образом, решение сводится к поиску точки пересечения с границей области интереса на отрезке. Такой подход значительно сокращает время выполнения алгоритма. Еще одним преимуществом предлагаемого решения является возможность применения любого набора методов для поиска пересечения. Стоит отметить, что, если хотя бы один сегмент пересёк границу исследуемой области, алгоритм не обрабатывает остальные отрезки, что позволяет значительно увеличить производительность без потери в точности.

\begin{figure}[!hb]
	\centering
	\includegraphics[width=0.5\linewidth]{fig_5}
	\caption{Суперпиксель (красный блок) пересекающий границу области интереса в трёх точках (зеленые точки).}
    \label{fig:5}
\end{figure}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.5\linewidth]{fig_6}
	\caption{Пример внешних суперпикселей, которые формируют контур области интереса (жёлтые блоки). Зелёные точки демонстрируют пересечения суперпикселей с границей объекта.}
    \label{fig:6}
\end{figure}

\bigbreak
Суперпиксели расставляются на изображении до тех пор, пока существует хотя бы один суперпиксель, который можно присоединить к итоговому региону без пересечения границ области интереса. Если нет ни одного суперпикселя с заданным размером, которые можно добавить, размер блока уменьшается вдвое, и процесс распространения продолжается. Важно отметить, что суперпиксели меньшего размера расставляются только в свободные области.

Если блоки достигли минимального размера и больше нет ни одной группы пикселей, которую можно присоединить к региону без пересечения границы области интереса, то происходит формирование контура из суперпикселей. Суперпиксель принадлежит контуру только в том случае, если он имеет минимальный размер и одна из его сторон или диагоналей пересекает границу области интереса. Пример расстановки суперпикселей разных размеров и поиска внешних суперпикселей показан на рисунке \ref{fig:6}. Зелёные точки указывают на пересечение суперпикселей с границей области интереса.

Процедура уменьшения размера суперпикселя может повторяться несколько раз, до тех пор, пока не будет достигнут минимальный размер суперпикселя. Минимальный размер суперпикселя является одним из параметров метода SPPS. Как можно заметить на рисунке \ref{fig:6}, на последнем шаге алгоритма объединённые суперпиксели региона с наименьшим размером (фиолетовые блоки) расположены достаточно близко к границе сегментируемой области, но не пересекают её.

\he{Формирование контура региона}

Как было описано выше, с целью формирования контура области интереса осуществляется обход внешних суперпикселей, которые не были прикреплены к региону. Набор внешних суперпикселей образует контур в соответствии с обязательным условием, описанным в разделе \ref{border_detection}. При определении контура обход происходит по часовой стрелке. Точки пересечения суперпикселя и границы области интереса сохраняются, создавая массив узловых пограничных точек. Такая же процедура выполняется для обхода внутренних границ региона, если таковые существуют.

Имея список узловых точек, строится кубический сплайн Эрмита, который описывает внутренний и внешний контуры сегментируемой области (см. рисунок \ref{fig:7}). Итоговая маска сегментируемой области показана полупрозрачным фиолетовым цветом на рисунке \ref{fig:7} .


Точкой пересечения является пиксель, который лежит на рёбрах или диагонали суперпексиля и находится в точке пересечения с границей исследуемой области. Алгоритм определения пересечения с границей области интереса описан в разделе \ref{border_detection}. После того, как все точки пересечения получены существует несколько вариантов формирования итогового контура. Наиболее примитивный – соединение каждой точки отрезками. Однако, такой подход значительно снижает итоговую точность сегментации. Оптимальный подход с точки зрения скорости и точности - построение регрессии полученных точек контура. Проведя исследование и анализ разных подходов, было принято решение отказаться от использования линейного сплайн, поскольку он дает значительную ошибку при построении границ контура. $B$-сплайн также снижает точность сегментации, так как не проходит через точки экстремума. Эмпирически было показано, что применение кубического эрмитова сплайна дает наиболее точный результат сегментации, что достигается за счёт возможности прохода через узловые точки и подбора достаточной кривизны на выпуклых и вогнутых участках изображения.

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.8\linewidth]{fig_7}
	\caption{Кубический сплайн Эрмита (синяя линия), проходящий через узловые точки (зелёные точки).}
    \label{fig:7}
\end{figure}


Таким образом, результатом метода сегментации является кубический сплайн, описывающий контур исследуемой области. Такое аналитическое представление может быть более предпочтительным, чем представление сегментированной области в форме маски. 

\newpage
\he{Определение размеров суперпикселей}

Методы сегментации на основании выращивания регионов обладают свойством «вытекания» через нечёткие и размытые границы. Некоторые модификации метода позволяют избежать этот эффект, однако, такие методы имеют высокую вычислительную сложность \cite{Ren2003}. Предлагаемый метод SPPS позволяет избежать эффекта «вытекания» путём увеличения минимального размера суперпикселя. Однако, стоит отметить, что размер минимального блока влияет на сглаженность итогового контура. Таким образом, чем больше сторона суперпикселя, тем более сглаженный и менее детализированный контур формируется на выходе. Обратная ситуация происходит при уменьшении размера суперпикселя, а именно, возрастает детализация границы, однако вероятность появления нежелательного эффекта разрыва границы увеличивается.

Начальный размер суперпикселя оказывает большое влияние на скорость работы алгоритма и напрямую зависит как от сегментируемой области, так и от разрешения изображения. Начальный размер суперпикселя $K$ в предложенном алгоритме был рассчитан на основании работы \cite{Duong2018}. Формула его  рассчёта представлена ниже:

\begin{equation}
	\label{eqn:4}
	K=\frac{N}{SF}
\end{equation}
где $N$ – число пикселей изображения, $SF$ – размер наименьшего сегментируемого объекта.

\he{Сложность алгоритма}

В стандартной реализации алгоритма выращивания регионов требуется по меньшей мере \textit{N}$^2$ операций для того, чтобы обработать изображение размером \textit{N}$\times$\textit{N} пикселей, что соответствует сложности алгоритма $O(n^2)$. В свою очередь, в предлагаемом алгоритме, для обработки изображения размером \textit{N}$\times$\textit{N} пикселей, требуется от \textit{3}$\times$\textit{N} до \textit{5}$\times$\textit{N} операций, в зависимости от параметров алгоритма. Единственным исключением является первый суперпиксель, для которого необходимо обработать \textit{6}$\times$\textit{N} пикселей, то есть все диагонали и рёбра суперпикселя. Таким образом, асимптотическая сложность алгоритма SPPS равна $O(n)$. Как будет показано ниже, прирост в скорости вычислений при подобных переходах особенно заметен на изображениях с высоким разрешением.  

\He{\uppercase{Результаты}}

В данном разделе приведены результаты оценки точности и скорости предлагаемого метода в зависимости от выбора его параметров. В качестве способа определения точности сегментации был использован коэффициент подобия Дайса (DSC, сокр. от Dice similarity coefficient).

\he{Сегментация левого желудочка}

Сегментация левого желудочка, выполненная представленным методом SPPS, методом выращивания регионов RG, методом активных контуров AC и эталонной сегментации GT, представлены на рисунке \ref{fig:9}. Как видно из рисунка \ref{fig:9}, для пациента 2 метод выращивания регионов сильно выходит за границы региона интереса, что не позволяет выполнить точную сегментацию. Аналогичная картина наблюдается для метода активных контуров. Несмотря на то, что подобные утечки могут быть нивелированы различного рода улучшениями, для работы с разрывами границ потребуются дополнительные вычислительные ресурсы. В свою очередь, метод SPPS позволяет избежать проблемы протекания в местах с низкой интенсивностью на границе за счёт управления размером суперпикселей.  

\begin{figure*}[!ht]
	\centering
	\begin{tabular}{ccc}
		\textbf{} & 
		\textbf{Пациент 1} & 
		\textbf{} \vspace{0.05cm} \\
		AC vs GT &
		RG vs GT & 
		SPPS vs GT \vspace{0.05cm} \\ 
		\includegraphics[width=0.31\linewidth]{fig_9_a_1}&
		\includegraphics[width=0.31\linewidth]{fig_9_b_1}&
		\includegraphics[width=0.31\linewidth]{fig_9_c_1} \vspace{0.05cm}
	\end{tabular}
	
	\begin{tabular}{ccc}
		\textbf{} & 
		\textbf{Пациент 2} & 
		\textbf{} \vspace{0.05cm} \\ 
		AC vs GT &
		RG vs GT & 
		SPPS vs GT \vspace{0.05cm} \\  
		\includegraphics[width=0.31\linewidth]{fig_9_a_2}&
		\includegraphics[width=0.31\linewidth]{fig_9_b_2}&
		\includegraphics[width=0.31\linewidth]{fig_9_c_2} \vspace{0.05cm}
	\end{tabular}	
	\caption{Сегментация левого желудочка в сравнении с эталонной сегментацией (зелёный контур).}
    \label{fig:9}
\end{figure*}

С целью оценки точности сегментации и времени обработки левого желудочка был использован набор данных, состоящий из 156 двухмерных изображений. Точность сегментации левого желудочка для метода SPPS с различными параметрами размеров суперпикселей показана на рисунке \ref{fig:10} и в таблице \ref{table:1}. 

\begin{figure}[!hbt]
	\centering
	\includegraphics[width=1.0\linewidth]{fig_10}
	\caption{Точность сегментации левого желудочка для рассматриваемых алгоритмов.}
    \label{fig:10}
\end{figure}

\begin{table}[ht]
\renewcommand{\arraystretch}{1.3}
\caption{Точность сегментации левого желудочка для рассматриваемых алгоритмов}
\label{table:1}
\begin{tabular}{ccc}
\hline
\textbf{SPPS 20-10-5} & \textbf{SPPS 16-8-4} & \textbf{SPPS 12-6-3} \\
0.93$\pm$0.03         & 0.91$\pm$0.07        & 0.89$\pm$0.10        \\\hline
\textbf{SPPS 8-4-2}   & \textbf{RG}          & \textbf{AC}          \\
0.86$\pm$0.11         & 0.88$\pm$0.09        & 0.71$\pm$0.17       
\\\hline
\end{tabular}
\end{table}

Кроме того, проведен анализ случаев «протекания» методов через границу области интереса. Такой анализ построен на основе оценки резкого снижения коэффициента Дайса (более 50$\%$). Результаты данного анализа приведены на рисунке \ref{fig:11}.

Как показано на рисунке \ref{fig:10} и в таблице \ref{table:1}, значения коэффициента Дайса для предлагаемого метода SPPS с размерами суперпикселей 8--4--2, 12--6--3 и метода выращивания регионов существенно не отличаются. Однако, интерквартильный размах значительно меньше у предлагаемого метода SPPS для параметров 20--10--5 и 16--8--4, чем у остальных методов. На исследуемом наборе данных метод активных контуров показал себя ненадёжным, что подтверждается большим размахом коэффициента Дайса. Следует отметить, что средняя точность метода SPPS выше в связи с тем, что подход к сегментации на основе суперпикселей позволяет избежать «протекания» через разрывы границ.

\begin{figure}[!ht]
	\centering
	\includegraphics[width=1.0\linewidth]{fig_11}
	\caption{Количество случаев ошибочной сегментации левого желудочка.}
    \label{fig:11}
\end{figure}

Более высокая эффективность предложенного метода  косвенно подтверждается его надёжности при сегментации регионов с разрывами. Последнее подтверждается низким уровнем утечек (см. рисунок \ref{fig:11}). В 21$\%$ исследованных случаев, контур, полученный посредством метода выращивания регионов, выходит за пределы области интереса. Последнее обусловлено размытыми границами или разрывами, что подтверждает низкий уровень надёжности данного метода. Схожая картина наблюдается для метода сегментации на основании активных контуров, где процент протекания составил почти 24$\%$. В свою очередь, подбор оптимального размера суперпикселя в предлагаемом методе SPPS позволяет снизить протекание.

\he{Сегментация опухоли мозга}

Сегментация опухоли головного мозга, выполненная представленным методом SPPS, методом выращивания регионов RG, методом активных контуров AC и эталонной сегментации GT, представлены на рисунке \ref{fig:12}. При исследованиях сегментации опухоли было выявлено, что алгоритм выращивания регионов RG сохраняет негативную тенденцию протекания через разрывы или размытия границ. Как показано на рисунке \ref{fig:12}, костная ткань ошибочно сегментирована для трёх представленных пациентов. С другой стороны, метод активных контуров AC выполняет сегментацию эффективнее на данных мозга, чем на данных сердца. В свою очередь, метод SPPS позволяет настраивать размер суперпикселей таким образом, что разрывы границ не оказывали негативного влияния на итоговую точность сегментации.

\begin{figure*}[!ht]
	\centering
	\begin{tabular}{ccc}
		\textbf{} & 
		\textbf{Пациент 1} & 
		\textbf{} \vspace{0.05cm} \\
		AC vs GT &
		RG vs GT & 
		SPPS vs GT \vspace{0.05cm} \\ 
		\includegraphics[width=0.31\linewidth]{fig_12_a_1}&
		\includegraphics[width=0.31\linewidth]{fig_12_b_1}&
		\includegraphics[width=0.31\linewidth]{fig_12_c_1} \vspace{0.05cm}
	\end{tabular}
	
	\begin{tabular}{ccc}
		\textbf{} & 
		\textbf{Пациент 2} & 
		\textbf{} \vspace{0.05cm} \\ 
		AC vs GT &
		RG vs GT & 
		SPPS vs GT \vspace{0.05cm} \\  
		\includegraphics[width=0.31\linewidth]{fig_12_a_2}&
		\includegraphics[width=0.31\linewidth]{fig_12_b_2}&
		\includegraphics[width=0.31\linewidth]{fig_12_c_2} \vspace{0.05cm}
	\end{tabular}	
	\caption{Сегментация опухоли мозга в сравнении с эталонной сегментацией (зелёный контур).}
    \label{fig:12}
\end{figure*}

С целью оценки точности сегментации и расчёта времени обработки опухоли головного мозга был использован набор данных, состоящий из 300 двухмерных изображений. Точность сегментации опухоли головного мозга для метода SPPS с различными параметрами размеров суперпикселей показана на рисунке \ref{fig:13} и в таблице \ref{table:2}. Кроме того, общее число случаев с низкой точностью, показано на рисунке \ref{fig:14}.

\begin{figure}[ht]
	\centering
	\includegraphics[width=1.0\linewidth]{fig_13}
	\caption{Точность сегментации опухоли головного мозга для рассматриваемых алгоритмов.}
    \label{fig:13}
\end{figure}

\begin{table}[ht]
\renewcommand{\arraystretch}{1.3}
\caption{Точность сегментации опухоли головного мозга для рассматриваемых алгоритмов}
\label{table:2}
\begin{tabular}{ccc}
\hline
\textbf{SPPS 20-10-5} & \textbf{SPPS 16-8-4} & \textbf{SPPS 12-6-3} \\
0.89$\pm$0.07         & 0.88$\pm$0.08        & 0.88$\pm$0.08        \\\hline
\textbf{SPPS 8-4-2}   & \textbf{RG}          & \textbf{AC}          \\
0.87$\pm$0.09         & 0.86$\pm$0.10        & 0.83$\pm$0.13       
\\\hline
\end{tabular}
\end{table}

Как видно из таблицы \ref{table:2}, существует корреляция между размерами суперпикселей и точностью. Чем меньше размер начального суперпикселя, тем ниже общая точность сегментации. Подобный эффект связан с тем, что в ряде изображений интенсивность пикселей опухоли не отличается от интенсивности костных тканей. Таким образом, при уменьшении размера суперпикселя увеличивается шанс попасть в область слияния региона интереса и заднего фона. 

\begin{figure}[ht]
	\centering
	\includegraphics[width=1.0\linewidth]{fig_14}
	\caption{Количество случаев ошибочной сегментации опухоли головного мозга.}
    \label{fig:14}
\end{figure}

\he{Время выполнения алгоритма}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.6\linewidth]{fig_15}
	\caption{Пример синтетического изображения с высокой контрастностью для оценки быстродействия алгоритмов.}
    \label{fig:15}
\end{figure}

Для того, чтобы более наглядно продемонстрировать разницу во времени выполнения предлагаемого метода SPPS с методом выращивания регионов RG и методом активных контуров AC были созданы синтетические изображения различного размера. Синтетическое изображение состоит из белого круга в центре и заднего фона чёрного цвета. Очевидно, точность сегментации таких данных близка к 100$\%$. Однако подобный подход позволяет продемонстрировать быстродействие методов. Пример синтетического изображения приведён на рисунке \ref{fig:15}. Как было указано выше, синтетическое изображение было сгенерировано в разных размерах. В результате тестирования методов, было получено время сегментации изображений разного размера. Данные результаты представлены на рисунке \ref{fig:16}. 

\begin{figure*}[!ht]
	\centering
	\begin{tabular}{ccc}
		\hspace{15pt} RG &
		\hspace{15pt} AC & 
		\hspace{15pt} SPPS \vspace{0.05cm} \\ 
		\includegraphics[width=0.31\linewidth]{fig_16_a}&
		\includegraphics[width=0.31\linewidth]{fig_16_b}&
		\includegraphics[width=0.31\linewidth]{fig_16_c} \vspace{0.05cm}
	\end{tabular}
	\caption{Среднее время сегментации в зависимости от размера изображения.}
    \label{fig:16}
\end{figure*}

Для сравнения предлагаемого метода SPPS с методами RG и AC были использованы следующие параметры: размер начального суперпикселя – 16 пикселей, последующие размеры суперпикселей 8 и 4 пикселей. Для методов выращивания регионов и активных контуров были выбраны настройки по умолчанию. Видно, что на относительно малых изображениях время сегментации методов RG и AC приемлемое. Однако для изображений с разрешением более 1000$\times$1000 время сегментации этих методов становится сравнительно большим. При увеличении разрешения разрыв во времени выполнения только увеличивается. Таким образом, предлагаемый метод SPPS в силу своей низкой вычислительной сложности, показывает возможность эффективного решения задач сегментации изображений высокого разрешения.   

\He{\uppercase{Заключение}}

Предложенный в работе метод показывает высокую точность и производительность при сегментации изображений с высоким разрешением, медицинских данных с дефектами границы области интереса или изображений с низкой контрастностью. Кроме того, метод может применяться для разметки данных в полуавтоматическом режиме. Наиболее значимым параметром алгоритма, влияющим на быстродействие, является максимальный и минимальный размеры суперпикселей. Увеличение размера наибольшего суперпикселя ускоряет обработку изображения, но снижает детализацию контура. Другой важной особенностью предложенного метода является масштабируемость. Обуславливается это тем, что комбинации различных методов могут быть использованы для обнаружения пересечения с границей исследуемой области, что потенциально повысит надёжность процесса сегментации. В качестве дополнительного алгоритма для обнаружения границ могут применяться методы машинного обучения, например одномерные нейронные сети. Следует также отметить, что данный метод может быть модифицирован для выполнения трёхмерной сегментации.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{thebibliography}{99}
\label{bib}
\bibitem{Huang2013}
{\em Huang X., Tsechpenakis G.} Medical Image Segmentation // Advanced Materials Research. 2009. № i. P. 1–35.

\bibitem{Rogowska2000}
{\em Rogowska J.} Overview and Fundamentals of Medical Image Segmentation // Handbook of Medical Imaging. Elsevier, 2000. P. 69–85.

\bibitem{Pham2000}
{\em Pham D.L., Xu C., Prince J.L.} Current Methods in Medical Image Segmentation // Annu. Rev. Biomed. Eng. 2000. Vol. 2, № 1. P. 315–337.

\bibitem{Kang2016}
{\em Kang H.C., Lee J., Shin J.} Automatic Four-Chamber Segmentation Using Level-Set Method and Split Energy Function // Healthc. Inform. Res. 2016. Vol. 22, № 4. P. 285.

\bibitem{Soliman2017}
{\em Soliman A. et al.} Accurate Lungs Segmentation on CT Chest Images by Adaptive Appearance-Guided Shape Modeling // IEEE Trans. Med. Imaging. 2017. Vol. 36, № 1. P. 263–276.

\bibitem{Oktay2018}
{\em Oktay O. et al.} Anatomically Constrained Neural Networks (ACNNs): Application to Cardiac Image Enhancement and Segmentation // IEEE Trans. Med. Imaging. 2018. Vol. 37, № 2. P. 384–395.

\bibitem{Pereira2016}
{\em Pereira S. et al.} Brain Tumor Segmentation Using Convolutional Neural Networks in MRI Images // IEEE Trans. Med. Imaging. 2016. Vol. 35, № 5. P. 1240–1251.

\bibitem{Kamnitsas2016}
{\em Kamnitsas K. et al.} Efficient Multi-Scale 3D CNN with Fully Connected CRF for Accurate Brain Lesion Segmentation // Med. Image Anal. 2016. Vol. 36. P. 61–78.

\bibitem{Litjens2017}
{\em Litjens G. et al.} A Survey on Deep Learning in Medical Image Analysis // Med. Image Anal. 2017. Vol. 42. P. 60–88.

\bibitem{Danilov2018}
{\em Danilov V.V. et al.} Catheter detection and segmentation in volumetric ultrasound using SVM and GLCM // Sci. Vis. 2018. Vol. 10, № 4. P. 30–39.

\bibitem{Danilov2019}
{\em Danilov V.V. et al.} Segmentation Algorithm Based on Square Blocks Propagation // Proceedings of the 29th International Conference on Computer Graphics and Vision / ed. Galaktionov V. et al. Aachen: CEUR Workshop Proceedings, 2019. P. 148–154.

\bibitem{Ballard1982}
{\em Ballard D.H., Brown C.M.} Computer Vision // Book. 1982. Vol. Computer S, № 1463. 119–149 p.

\bibitem{Adams1994}
{\em Adams R., Bischof L.} Seeded Region Growing // IEEE Trans. Pattern Anal. Mach. Intell. 1994. Vol. 16, № 6. P. 641–647.

\bibitem{Tang2010}
{\em Tang J.} A color image segmentation algorithm based on region growing // 2010 2nd International Conference on Computer Engineering and Technology. IEEE, 2010. Vol. 6. P. 634–637.

\bibitem{Park2009}
{\em Park J.G., Lee C.} Skull stripping based on region growing for magnetic resonance brain images // Neuroimage. 2009. Vol. 47, № 4. P. 1394–1407.

\bibitem{Chiverton2007}
{\em Chiverton J. et al.} Statistical morphological skull stripping of adult and infant MRI data // Comput. Biol. Med. 2007. Vol. 37, № 3. P. 342–357.

\bibitem{Roy2015}
{\em Roy S., Maji P.} A simple skull stripping algorithm for brain MRI // 2015 Eighth International Conference on Advances in Pattern Recognition (ICAPR). IEEE, 2015. P. 1–6.

\bibitem{Isa2005}
{\em Isa N.A.M. et al.} Automatic Detection of Breast Tumours from Ultrasound Images Using the Modified Seed Based Region Growing Technique // Lecture Notes in Computer Science (including subseries Lecture Notes in Artificial Intelligence and Lecture Notes in Bioinformatics). 2005. Vol. 3682 LNAI. P. 138–144.

\bibitem{Dehmeshki2008}
{\em Dehmeshki J. et al.} Segmentation of Pulmonary Nodules in Thoracic CT Scans: A Region Growing Approach // IEEE Trans. Med. Imaging. 2008. Vol. 27, № 4. P. 467–480.

\bibitem{Crommelinck2017}
{\em Crommelinck S. et al.} SLIC superpixels for object delineation UAV data // ISPRS Annals of the Photogrammetry, Remote Sensing and Spatial Information Sciences. 2017. Vol. 4, № 2W3. P. 9–16.

\bibitem{Csillik2017}
{\em Csillik O.} Fast Segmentation and Classification of Very High Resolution Remote Sensing Data Using SLIC Superpixels // Remote Sens. 2017. Vol. 9, № 3. P. 243.

\bibitem{Duong2018}
{\em Duong T.H., Hoberock L.L.} DUHO image segmentation based on unseeded region growing on superpixels // 2018 IEEE 8th Annual Computing and Communication Workshop and Conference (CCWC). IEEE, 2018. P. 558–563.

\bibitem{Saxen2014}
{\em Saxen F., Al-Hamadi A.} Superpixels for Skin Segmentation // Workshop Farbbildverarbeitung. 2014. P. 153–159.

\bibitem{Ren2003}
{\em Ren X., Malik J.} Learning a classification model for segmentation // Proceedings of the Ninth IEEE International Conference on Computer Vision. 2003. Vol. 2. P. 10.

\bibitem{Achanta2012}
{\em Achanta R. et al.} SLIC Superpixels Compared to State-of-the-Art Superpixel Methods // IEEE Trans. Pattern Anal. Mach. Intell. 2012. Vol. 34, № 11. P. 2274–2282.

\bibitem{Andreopoulos2008}
{\em Andreopoulos A., Tsotsos J.K.} Efficient and generalizable statistical models of shape and appearance for analysis of cardiac MRI // Med. Image Anal. 2008. Vol. 12, № 3. P. 335–357.

\bibitem{Cheng2015}
{\em Cheng J. et al.} Enhanced Performance of Brain Tumor Classification via Tumor Region Augmentation and Partition // PLoS One / ed. Zhang D. 2015. Vol. 10, № 10.

\newpage
\bibitem{Cheng2016}
{\em Cheng J. et al.} Retrieval of Brain Tumors by Adaptive Spatial Pooling and Fisher Vector Representation // PLoS One. 2016. Vol. 11, № 6.

\bibitem{Wang2015}
{\em Wang L. et al.} Left Ventricle: Fully Automated Segmentation Based on Spatiotemporal Continuity and Myocardium Information in Cine Cardiac Magnetic Resonance Imaging (LV-FAST) // Biomed Res. Int. 2015. Vol. 2015. P. 1–9.
\end{thebibliography}

\label{lastpage}
\end{document}






